# ASP.NET Core API Base - StarterPack

üöÄ **Projeto base para cria√ß√£o r√°pida de APIs ASP.NET Core com Entity Framework, AutoMapper e SQLite**

[![.NET 8](https://img.shields.io/badge/.NET-8.0-blue.svg)](https://dotnet.microsoft.com/download/dotnet/8.0)
[![Entity Framework Core](https://img.shields.io/badge/EF%20Core-9.0.8-green.svg)](https://docs.microsoft.com/ef/)
[![SQLite](https://img.shields.io/badge/SQLite-Database-lightgrey.svg)](https://www.sqlite.org/)
[![AutoMapper](https://img.shields.io/badge/AutoMapper-12.0.1-orange.svg)](https://automapper.org/)

## üìã Sobre o Projeto

## üèóÔ∏è Arquitetura

O projeto segue uma arquitetura em camadas bem definida:

```
CoreApiBase/          # üéØ Camada de Apresenta√ß√£o (API)
‚îú‚îÄ‚îÄ Controllers/      # Controladores da API
‚îú‚îÄ‚îÄ Application/      # DTOs e modelos de aplica√ß√£o
‚îú‚îÄ‚îÄ Extensions/       # M√©todos de extens√£o para DI
‚îú‚îÄ‚îÄ Configurations/   # Configura√ß√µes do projeto
‚îî‚îÄ‚îÄ Middlewares/      # Middlewares customizados

CoreDomainBase/       # üß† Camada de Dom√≠nio e Dados
‚îú‚îÄ‚îÄ Entities/         # Entidades do dom√≠nio
‚îú‚îÄ‚îÄ Services/         # Servi√ßos de neg√≥cio
‚îú‚îÄ‚îÄ Repositories/     # Reposit√≥rios de dados
‚îú‚îÄ‚îÄ Interfaces/       # Contratos e interfaces
‚îî‚îÄ‚îÄ Data/            # Contexto do banco e configura√ß√µes EF
    ‚îî‚îÄ‚îÄ Configurations/ # Configura√ß√µes das entidades

Tests/               # üß™ Testes
‚îú‚îÄ‚îÄ UnitTests/       # Testes unit√°rios
‚îî‚îÄ‚îÄ IntegrationTests/ # Testes de integra√ß√£o
```

## ‚ú® Caracter√≠sticas

- ‚úÖ **ASP.NET Core 8.0** - Framework moderno e perform√°tico
- ‚úÖ **Entity Framework Core** - ORM com SQLite pr√©-configurado
- ‚úÖ **AutoMapper** - Mapeamento autom√°tico entre entidades e DTOs
- ‚úÖ **Swagger/OpenAPI** - Documenta√ß√£o autom√°tica da API
- ‚úÖ **Inje√ß√£o de Depend√™ncia** - Configurada e pronta para uso
- ‚úÖ **Padr√£o Repository** - Implementa√ß√£o gen√©rica de reposit√≥rios
- ‚úÖ **CRUD Completo** - Exemplo funcional com entidade User
- ‚úÖ **Migrations** - Controle de vers√£o do banco de dados
- ‚úÖ **Estrutura Limpa** - Separa√ß√£o clara de responsabilidades
- ‚úÖ **JWT Authentication** - Sistema de autentica√ß√£o baseado em tokens
- ‚úÖ **Health Checks** - Monitoramento da sa√∫de da aplica√ß√£o
- ‚úÖ **Docker Secrets** - Configura√ß√£o segura para produ√ß√£o
- ‚úÖ **Configuration Validation** - Valida√ß√£o autom√°tica de configura√ß√µes

## üöÄ Como Executar

### Op√ß√£o 1: Configura√ß√£o Autom√°tica Segura (Recomendado)

**Para desenvolvedores que acabaram de clonar o projeto:**

1. **Clone o reposit√≥rio**
   ```bash
   git clone https://github.com/EricCoisa/AspNetCoreApiBase.git
   cd AspNetCoreApiBase
   ```

2. **Execute o script de configura√ß√£o**
   
   **Windows:**
   ```bash
   setup-configuration.bat development
   ```
   
   **Linux/Mac:**
   ```bash
   chmod +x setup-configuration.sh
   ./setup-configuration.sh development
   ```

3. **Execute o projeto**
   ```bash
   dotnet run --project CoreApiBase
   ```

### Op√ß√£o 2: Docker (Produ√ß√£o)

1. **Configure para Docker**
   ```bash
   # Windows
   setup-configuration.bat docker
   
   # Linux/Mac
   ./setup-configuration.sh docker
   ```

2. **Execute com Docker Compose**
   ```bash
   docker-compose up --build
   ```

### Op√ß√£o 3: Configura√ß√£o Manual

Se preferir configurar manualmente:

1. **Copie o arquivo de exemplo**
   ```bash
   copy secrets.env.example secrets.env    # Windows
   cp secrets.env.example secrets.env      # Linux/Mac
   ```

2. **Edite o arquivo `secrets.env`** com suas configura√ß√µes:
   ```env
   JWT_SECRET_KEY=SuaChaveSecretaAqui
   DATABASE_CONNECTION_STRING=Data Source=appdb.sqlite
   CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
   ```

3. **Configure User Secrets** (opcional para desenvolvimento):
   ```bash
   dotnet user-secrets init --project CoreApiBase
   dotnet user-secrets set "JwtSettings:SecretKey" "SuaChaveSecreta" --project CoreApiBase
   ```

### Pr√©-requisitos
- [.NET 8.0 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)
- [Visual Studio 2022](https://visualstudio.microsoft.com/) ou [VS Code](https://code.visualstudio.com/)
- [Docker](https://www.docker.com/) (opcional)

## üîí Sistema de Configura√ß√£o Segura

O projeto implementa um sistema de configura√ß√£o com 5 n√≠veis de prioridade:

1. **appsettings.json** (base)
2. **appsettings.{Environment}.json** (ambiente espec√≠fico)
3. **User Secrets** (desenvolvimento local)
4. **Environment Variables** (sistema/container)
5. **Docker Secrets** (produ√ß√£o Docker) - **Maior prioridade**

### Configura√ß√µes Dispon√≠veis

- `JWT_SECRET_KEY`: Chave secreta para tokens JWT
- `DATABASE_CONNECTION_STRING`: String de conex√£o do banco
- `CORS_ALLOWED_ORIGINS`: Origens permitidas para CORS

### Scripts de Configura√ß√£o

O projeto agora possui apenas **um script √∫nico** que faz toda a configura√ß√£o automaticamente:

- `setup-configuration.bat` (Windows)  
- `setup-configuration.sh` (Linux/Mac)

Este script √∫nico automatiza:
- ‚úÖ Gera√ß√£o segura de chaves criptogr√°ficas
- ‚úÖ Configura√ß√£o de User Secrets para desenvolvimento
- ‚úÖ Prepara√ß√£o de Docker Secrets para produ√ß√£o
- ‚úÖ Valida√ß√£o de configura√ß√µes

### Script de Limpeza

Para testar do zero ou limpar configura√ß√µes antigas:

- `cleanup-secrets.bat` (Windows)
- `cleanup-secrets.sh` (Linux/Mac)

Este script remove:
- üßπ Todos os User Secrets
- üßπ Pasta secrets/ e arquivos de configura√ß√£o
- üßπ Containers e volumes Docker
- üßπ Bancos de dados SQLite locais

## üìä Health Checks

A aplica√ß√£o inclui endpoints de sa√∫de integrados ao Swagger:

- **GET** `/health` - Status geral da aplica√ß√£o
- **GET** `/health/ready` - Verifica√ß√£o de prontid√£o
- **GET** `/health/live` - Verifica√ß√£o de vitalidade

### Valida√ß√µes Inclu√≠das
- ‚úÖ Configura√ß√µes obrigat√≥rias
- ‚úÖ Conectividade com banco de dados  
- ‚úÖ Valida√ß√£o de chaves JWT
- ‚úÖ Status dos servi√ßos essenciais

## üéØ Endpoints Dispon√≠veis

### Authentication API
| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| POST | `/Authentication/register` | Registra novo usu√°rio |
| POST | `/Authentication/login` | Autentica usu√°rio |
| GET | `/Authentication/profile` | Perfil do usu√°rio logado |
| POST | `/Authentication/refresh-token` | Atualiza token JWT |
| POST | `/Authentication/revoke-token` | Revoga token de usu√°rio |

### Users API (Admin)
| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| GET | `/User` | Lista todos os usu√°rios |
| GET | `/User/{id}` | Busca usu√°rio por ID |
| POST | `/User` | Cria novo usu√°rio |
| PUT | `/User/{id}` | Atualiza usu√°rio |
| DELETE | `/User/{id}` | Remove usu√°rio |

### Health Checks
| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| GET | `/health` | Status geral |
| GET | `/health/ready` | Prontid√£o da aplica√ß√£o |
| GET | `/health/live` | Vitalidade da aplica√ß√£o |

### Exemplo de Payload
```json
{
  "name": "Jo√£o Silva",
  "email": "joao@email.com",
  "password": "123456"
}
```

### Acesso √† API
- **API:** `http://localhost:5099`
- **Swagger:** `http://localhost:5099/swagger`
- **Health Check:** `http://localhost:5099/health`

## ‚öôÔ∏è Configura√ß√£o Avan√ßada

### Adicionando Novas Entidades

1. **Crie a entidade** em `CoreDomainBase/Entities/`
2. **Crie o DTO** em `CoreApiBase/Application/DTOs/`
3. **Configure o mapeamento** em `CoreDomainBase/Data/Configurations/`
4. **Adicione ao DbContext** em `CoreDomainBase/Data/AppDbContext.cs`
5. **Execute a migration**:
   ```bash
   dotnet ef migrations add NomeDaMigration --project CoreApiBase
   dotnet ef database update --project CoreApiBase
   ```

### Customizando Connection String

Para ambientes espec√≠ficos, edite os arquivos de configura√ß√£o:

**appsettings.Development.json:**
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=appdb_dev.sqlite"
  }
}
```

**Docker Secrets (Produ√ß√£o):**
```bash
echo "Data Source=/app/data/production.db" | docker secret create db_connection_string -
```

## üß™ Testes

Execute os testes do projeto:
```bash
dotnet test
```

### Testes de Health Check
```bash
# Teste direto do endpoint
curl http://localhost:5099/health

# Teste detalhado
curl http://localhost:5099/health?detailed=true
```

## üì¶ Pacotes Inclu√≠dos

| Pacote | Vers√£o | Prop√≥sito |
|--------|--------|-----------|
| Microsoft.EntityFrameworkCore.Sqlite | 9.0.8 | Provider SQLite para EF Core |
| Microsoft.EntityFrameworkCore.Design | 9.0.8 | Ferramentas de design do EF |
| AutoMapper | 12.0.1 | Mapeamento objeto-objeto |
| AutoMapper.Extensions.Microsoft.DependencyInjection | 12.0.1 | Integra√ß√£o AutoMapper com DI |
| Swashbuckle.AspNetCore | 6.6.2 | Documenta√ß√£o Swagger |
| Microsoft.AspNetCore.Authentication.JwtBearer | 8.0.0 | Autentica√ß√£o JWT |
| Microsoft.Extensions.Diagnostics.HealthChecks | 8.0.0 | Health Checks |

## üîê Seguran√ßa

### JWT Authentication
- Tokens com expira√ß√£o configur√°vel
- Refresh tokens para renova√ß√£o segura
- Middleware de valida√ß√£o de security stamp
- Revoga√ß√£o de tokens por usu√°rio

### Configura√ß√£o Segura
- User Secrets para desenvolvimento
- Docker Secrets para produ√ß√£o
- Vari√°veis de ambiente como fallback
- Valida√ß√£o autom√°tica de configura√ß√µes obrigat√≥rias

### CORS
Configura√ß√£o flex√≠vel para diferentes ambientes:
```json
{
  "AllowedOrigins": ["http://localhost:3000", "https://meuapp.com"]
}
```

## üê≥ Docker

### Desenvolvimento com Visual Studio
O projeto inclui perfis Docker para o Visual Studio:
- **Container (Dockerfile)**: Debug em container
- **Docker Compose**: Orquestra√ß√£o completa

### Arquivos Docker
- `Dockerfile`: Multi-stage build otimizado
- `docker-compose.yml`: Orquestra√ß√£o com secrets
- `.dockerignore`: Exclus√µes para build eficiente

## üöÄ Deploy

### Prepara√ß√£o para Produ√ß√£o
1. Execute o script de configura√ß√£o para produ√ß√£o:
   ```bash
   setup-configuration.bat production  # Windows
   ./setup-configuration.sh production # Linux
   ```

2. Configure os Docker Secrets:
   ```bash
   docker secret create jwt_secret_key jwt_key.txt
   docker secret create db_connection_string db_conn.txt
   ```

3. Deploy com Docker Swarm ou Kubernetes conforme sua infraestrutura.

## ü§ù Contribui√ß√£o

1. Fa√ßa um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üîó Links √öteis

- [Documenta√ß√£o ASP.NET Core](https://docs.microsoft.com/aspnet/core/)
- [Entity Framework Core](https://docs.microsoft.com/ef/core/)
- [AutoMapper](https://docs.automapper.org/)
- [Swagger/OpenAPI](https://swagger.io/)
- [Docker Secrets](https://docs.docker.com/engine/swarm/secrets/)
- [Health Checks](https://docs.microsoft.com/aspnet/core/host-and-deploy/health-checks)

---

‚≠ê **Se este projeto foi √∫til para voc√™, considere dar uma estrela!**

## üèóÔ∏è Arquitetura

O projeto segue uma arquitetura em camadas bem definida:

```
CoreApiBase/          # üéØ Camada de Apresenta√ß√£o (API)
‚îú‚îÄ‚îÄ Controllers/      # Controladores da API
‚îú‚îÄ‚îÄ Application/      # DTOs e modelos de aplica√ß√£o
‚îú‚îÄ‚îÄ Extensions/       # M√©todos de extens√£o para DI
‚îú‚îÄ‚îÄ Configurations/   # Configura√ß√µes do projeto
‚îî‚îÄ‚îÄ Middlewares/      # Middlewares customizados

CoreDomainBase/       # üè¢ Camada de Dom√≠nio e Dados
‚îú‚îÄ‚îÄ Entities/         # Entidades do dom√≠nio
‚îú‚îÄ‚îÄ Services/         # Servi√ßos de neg√≥cio
‚îú‚îÄ‚îÄ Repositories/     # Reposit√≥rios de dados
‚îú‚îÄ‚îÄ Interfaces/       # Contratos e interfaces
‚îî‚îÄ‚îÄ Data/            # Contexto do banco e configura√ß√µes EF
    ‚îî‚îÄ‚îÄ Configurations/ # Configura√ß√µes das entidades

Tests/               # üß™ Testes
‚îú‚îÄ‚îÄ UnitTests/       # Testes unit√°rios
‚îî‚îÄ‚îÄ IntegrationTests/ # Testes de integra√ß√£o
```

## ‚ö° Caracter√≠sticas

- ‚úÖ **ASP.NET Core 8.0** - Framework moderno e perform√°tico
- ‚úÖ **Entity Framework Core** - ORM com SQLite pr√©-configurado
- ‚úÖ **AutoMapper** - Mapeamento autom√°tico entre entidades e DTOs
- ‚úÖ **Swagger/OpenAPI** - Documenta√ß√£o autom√°tica da API
- ‚úÖ **Inje√ß√£o de Depend√™ncia** - Configurada e pronta para uso
- ‚úÖ **Padr√£o Repository** - Implementa√ß√£o gen√©rica de reposit√≥rios
- ‚úÖ **CRUD Completo** - Exemplo funcional com entidade User
- ‚úÖ **Migrations** - Controle de vers√£o do banco de dados
- ‚úÖ **Estrutura Limpa** - Separa√ß√£o clara de responsabilidades
- ‚úÖ **Autentica√ß√£o JWT** - Sistema seguro de autentica√ß√£o
- ‚úÖ **Health Checks** - Monitoramento da aplica√ß√£o
- ‚úÖ **Docker Support** - Containeriza√ß√£o pronta para produ√ß√£o
- ‚úÖ **Configura√ß√£o Segura** - Sistema autom√°tico de secrets
